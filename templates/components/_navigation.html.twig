<nav class="navbar navbar-dark _position-relative shadow_ rounded-0" style="z-index: 1030;">
    <div class="container">
        <!-- Brand -->
        <div class="d-flex align-items-center">
            <a class="navbar-brand d-flex align-items-center" href="{{ path('app_home') }}">
                <img src="{{ asset('build/images/logo-sm.png') }}" alt="CitadelQuest" height="43" class="me-2">
                <div class="d-none d-sm-block">
                    <span>{{ 'app.name'|trans }}</span>
                    <div class="small text-muted-light">{{ citadel_version }}</div>
                </div>
            </a>
            <button id="theme-toggle" class="btn btn-sm btn-link text-light p-0" title="Toggle theme">
                <i class="mdi mdi-image"></i>
            </button>
        </div>

        <!-- Navigation Items -->
        <ul class="nav align-items-center">
        {% if app.user %}
            <!-- Spirit Icon -->
            <li class="nav-item">
                {{ include('components/_spirit_icon.html.twig') }}
            </li>

            <!-- User Menu -->
            <li class="nav-item dropdown">
                <a class="nav-link" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="mdi mdi-account{% if app.user.roles|filter(role => role == 'ROLE_ADMIN')|length > 0 %}-cowboy-hat{% endif %}"></i>
                    <span class="d-none d-sm-inline ms-1">{{ app.user.userIdentifier }}</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end glass-panel glass-panel-glow" aria-labelledby="userDropdown">
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('spirit_index') }}">
                            <i class="mdi mdi-ghost me-3{% if app.request.pathInfo == path('spirit_index') %} text-cyber{% endif %}"></i>
                            <span class="spiritName">{{ 'spirit.menu.settings'|trans }}</span>
                        </a>
                    </li>
                    {# <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('diary_index') }}">
                            <i class="mdi mdi-book me-3{% if app.request.pathInfo == path('diary_index') %} text-cyber{% endif %}"></i>
                            {{ 'diary.title'|trans }}
                        </a>
                    </li> #}
                    {# <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_visual_design') }}">
                            <i class="mdi mdi-palette me-3{% if app.request.pathInfo == path('app_visual_design') %} text-cyber{% endif %}"></i>
                            {{ 'navigation.user_menu.visual_design'|trans }}
                        </a>
                    </li> #}
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    {# <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_user_settings_profile') }}">
                            <i class="mdi mdi-account me-3{% if app.request.pathInfo == path('app_user_settings_profile') %} text-cyber{% endif %}"></i>
                            {{ 'navigation.user_menu.profile'|trans }}
                        </a>
                    </li> #}

                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_cq_contact_index') }}">
                            <i class="mdi mdi-account-group me-3{% if app.request.pathInfo == path('app_cq_contact_index') %} text-cyber{% endif %}"></i>
                            {{ 'cq_contact.page_title'|trans }}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_file_browser') }}">
                            <i class="mdi mdi-file-star me-3{% if app.request.pathInfo == path('app_file_browser') %} text-cyber{% endif %}"></i>
                            {{ 'file_browser.page_title'|trans }}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_user_settings') }}">
                            <i class="mdi mdi-tune-vertical me-3{% if app.request.pathInfo starts with path('app_user_settings') %} text-cyber{% endif %}"></i>
                            {{ 'navigation.user_menu.settings'|trans }}
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_backup_index') }}">
                            <i class="mdi mdi-backup-restore me-3{% if app.request.pathInfo == path('app_backup_index') %} text-cyber{% endif %}"></i>
                            {{ 'navigation.user_menu.backup'|trans }}
                        </a>
                    </li>
                    {% if is_granted('ROLE_ADMIN') %}
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_admin_dashboard') }}">
                            <i class="mdi mdi-account-cowboy-hat me-3{% if app.request.pathInfo starts with '/admin' %} text-cyber{% endif %}"></i>
                            {{ 'navigation.user_menu.admin'|trans }}
                        </a>
                    </li>
                    {% endif %}
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li>
                        <a class="dropdown-item nav-link ps-3" href="{{ path('app_logout') }}">
                            <i class="mdi mdi-logout me-3"></i>
                            {{ 'navigation.user_menu.logout'|trans }}
                        </a>
                    </li>
                </ul>
            </li>

            <!-- Notifications -->
            <li class="nav-item dropdown">
                {{ include('components/_notifications.html.twig') }}
            </li>
            
        {% else %}
            <!-- Login/Register -->
            <li class="nav-item">
                <a class="nav-link" href="{{ path('app_login') }}"><i class="mdi mdi-login me-2"></i><span class="d-none d-sm-inline">{{ 'navigation.menu.login'|trans }}</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{{ path('app_register') }}"><i class="mdi mdi-account-plus me-2"></i><span class="d-none d-sm-inline">{{ 'navigation.menu.register'|trans }}</span></a>
            </li>
        {% endif %}
            
            <!-- Language Selector -->
            <li class="nav-item dropdown {% if app.user %}d-none d-sm-inline{% endif %}">
                <a class="nav-link" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false" title="{{ 'navigation.language.title'|trans }}">
                    <i class="mdi mdi-translate"></i>
                </a>
                <ul class="dropdown-menu dropdown-menu-end glass-panel glass-panel-glow" aria-labelledby="languageDropdown">
                    <li><a class="dropdown-item nav-link ps-3 language-switch{% if app.request.locale == 'en' %} active{% endif %}" href="#" data-locale="en">{{ 'navigation.language.en'|trans }}</a></li>
                    <li><a class="dropdown-item nav-link ps-3 language-switch{% if app.request.locale == 'cs' %} active{% endif %}" href="#" data-locale="cs">{{ 'navigation.language.cs'|trans }}</a></li>
                    <li><a class="dropdown-item nav-link ps-3 language-switch{% if app.request.locale == 'sk' %} active{% endif %}" href="#" data-locale="sk">{{ 'navigation.language.sk'|trans }}</a></li>
                </ul>
            </li>
        </ul>
    </div>
</nav>
