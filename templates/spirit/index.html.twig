{% extends 'base.html.twig' %}

{% block title %}{{ 'spirit.title'|trans }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('spirit') }}
{% endblock %}

{% block body %}
<div class="container mt-4">
    <input type="hidden" id="spirit-id" value="{{ spiritId is defined ? spiritId : '' }}">
    <div class="glass-panel pt-4">
        {# <div class="text-white p-4">
            <h2 class="mb-0">{{ 'spirit.title'|trans }}</h2>
        </div> #}
        <div class="px-4 pb-4 pt-1">
            <div id="spirit-container">
                <div class="text-center mb-4" id="spirit-loading">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">{{ 'ui.loading'|trans }}</span>
                    </div>
                    <p class="mt-2">{{ 'spirit.detail.connecting'|trans }}</p>
                </div>
                
                <div id="spirit-display" class="d-none">
                    <div class="row">
                        <div class="col-md-5">
                                <div class="spirit-avatar-container big">
                                    <div id="spiritChatAvatar" class="spirit-avatar d-flex align-items-center justify-content-center text-secondary">
                                        <i class="mdi mdi-ghost spiritChatButtonIcon"></i>
                                    </div>
                                </div>
                            <div class="text-center mt-5">
                                <h3 id="spirit-name-display" class="mb-2">{{ 'spirit.name'|trans }}</h3>
                                <div class="d-flex justify-content-center align-items-center">
                                    <span class="badge bg-primary">{{ 'spirit.level'|trans }} <span id="spirit-level">1</span></span>
                                </div>
                            </div>
                            <div class="progress mt-3">
                                <div id="spirit-experience-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
                                        role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" 
                                        style="width: 0%">
                                </div>
                            </div>
                            <p class="text-center mt-1">
                                <small>{{ 'spirit.experience'|trans }}: <span id="spirit-experience">0</span>/<span id="spirit-next-level">100</span></small>
                            </p>

                            <h4>{{ 'spirit.spirit_detail.interactions'|trans }}</h4>
                            <div id="spirit-interactions">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">{{ 'ui.loading'|trans }}</span>
                                </div>
                                <span>{{ 'spirit.detail.loading_interactions'|trans }}</span>
                            </div>
                            
                            {# <div class="mt-4">
                                <div class="form-group mb-3">
                                    <label for="spirit-ai-model" class="form-label">AI Model</label>
                                    <select id="spirit-ai-model" class="form-select">
                                        <option value="anthropic/claude-3-7-sonnet-latest">Claude 3.7 Sonnet</option>
                                        <option value="anthropic/claude-3-5-haiku-latest">Claude 3.5 Haiku</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="spirit-system-prompt" class="form-label">System Prompt</label>
                                    <textarea id="spirit-system-prompt" class="form-control" rows="6" placeholder="Define your Spirit's character and abilities..."></textarea>
                                    <div class="form-text text-muted p-2">Define how your Spirit should behave and what knowledge it should have.</div>
                                </div>
                                <div class="text-center mt-2">
                                    <button id="update-spirit-settings" class="btn btn-sm btn-cyber"><i class="mdi mdi-check me-1"></i>Save Settings</button>
                                </div>
                            </div> #}
                        </div>
                        <div class="col-md-7">
                            <h4 class="mt-5">{{ 'spirit.spirit_detail.conversations'|trans }}</h4>
                            <div id="conversations-list">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">{{ 'ui.loading'|trans }}</span>
                                </div>
                                <span>{{ 'spirit.detail.loading_conversations'|trans }}</span>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<div data-translations="{{ {}
    |merge({'spirit.no_interactions': 'No interactions recorded yet.'|trans})
    |merge({'error.loading_spirit': 'Failed to load spirit'|trans})
    |merge({'error.creating_spirit': 'Failed to create spirit'|trans})
    |merge({'error.interaction_failed': 'Failed to interact with spirit'|trans})
    |merge({'error.loading_interactions': 'Failed to load interactions'|trans})
    |json_encode|e('html_attr') }}">
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('spirit') }}
{% endblock %}
