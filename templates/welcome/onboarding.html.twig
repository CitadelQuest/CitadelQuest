{% extends 'base.html.twig' %}

{% block title %}{{ 'welcome.onboarding.title'|trans }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('welcome-onboarding') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('welcome-onboarding') }}
{% endblock %}

{% block body %}
<div class="container onboarding-container">
    {# Pass AI models data to JavaScript #}
    <div id="availableModels" data-models="{{ aiModelsArray|json_encode|e('html_attr') }}" class="d-none"></div>
    
    {# Hidden inputs for model IDs #}
    {% for model in aiModels %}
        {% if model.modelSlug is defined and model.modelSlug matches '/claude-3-sonnet/i' %}
            <input type="hidden" name="modelId" value="{{ model.id }}" data-model="claude" />
        {% elseif model.modelSlug is defined and model.modelSlug matches '/gemini/i' %}
            <input type="hidden" name="modelId" value="{{ model.id }}" data-model="gemini" />
        {% elseif model.modelSlug is defined and model.modelSlug matches '/grok/i' %}
            <input type="hidden" name="modelId" value="{{ model.id }}" data-model="grok" />
        {% endif %}
    {% endfor %}
    <div class="text-center mb-5">
        <h1 class="display-4">{{ 'welcome.onboarding.welcome'|trans|default('Welcome to CitadelQuest') }}</h1>
        <p class="lead">{{ 'welcome.onboarding.subtitle'|trans|default('Let\'s set up your personal AI assistant') }}</p>
    </div>
    
    <div class="step-indicator">
        <div class="step-dot active" data-step="1"></div>
        <div class="step-dot" data-step="2"></div>
        <div class="step-dot" data-step="3"></div>
    </div>
    
    <div class="glass-panel p-4 mb-4">
        <!-- Step 1: Connect CQ AI Gateway -->
        <div class="step-container active" id="step1">
            <div class="row">
                <div class="col-md-6">
                    <h2>{{ 'welcome.onboarding.step1.title'|trans|default('Connect to CQ AI Gateway') }}</h2>
                    <p>{{ 'welcome.onboarding.step1.description'|trans|default('To start your journey, you need to connect to the CQ AI Gateway. This will give you access to powerful AI models.') }}</p>
                    
                    <div class="form-group mb-3">
                        <label for="apiKey">{{ 'welcome.onboarding.step1.api_key_label'|trans|default('Your CQ AI Gateway API Key') }}</label>
                        <input type="password" class="form-control api-key-input" id="apiKey" placeholder="{{ 'welcome.onboarding.step1.api_key_placeholder'|trans|default('Paste your API key here') }}">
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <a href="https://cqaigateway.com/" target="_blank" class="text-info">
                            {{ 'welcome.onboarding.step1.get_key'|trans|default('Need an API key?') }}
                        </a>
                        <button id="validateApiKey" class="btn btn-cta" disabled>
                            {{ 'welcome.onboarding.step1.validate'|trans|default('Validate & Continue') }}
                        </button>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <img src="{{ asset('images/spirit-inactive.svg') }}" alt="Spirit" class="img-fluid spirit-inactive" id="spiritImage" style="max-height: 200px;">
                </div>
            </div>
        </div>
        
        <!-- Step 2: Create Spirit -->
        <div class="step-container" id="step2">
            <div class="row">
                <div class="col-md-6">
                    <h2>{{ 'welcome.onboarding.step2.title'|trans|default('Create Your Spirit') }}</h2>
                    <p>{{ 'welcome.onboarding.step2.description'|trans|default('Your Spirit is your personal AI assistant. Give it a name and choose its appearance.') }}</p>
                    
                    <div class="form-group mb-3">
                        <label for="spiritName">{{ 'welcome.onboarding.step2.name_label'|trans|default('Spirit Name') }}</label>
                        <input type="text" class="form-control api-key-input" id="spiritName" placeholder="{{ 'welcome.onboarding.step2.name_placeholder'|trans|default('Enter a name for your Spirit') }}">
                    </div>
                    
                    <div class="form-group mb-3">
                        <label>{{ 'welcome.onboarding.step2.model_label'|trans|default('Select AI Model') }}</label>
                        <div class="d-flex flex-wrap gap-2">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="aiModel" id="modelClaude" value="anthropic/claude-3.5-haiku" checked>
                                <label class="form-check-label" for="modelClaude">
                                    {{ 'welcome.onboarding.step2.model_claude'|trans|default('Claude') }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="aiModel" id="modelGemini" value="google/gemini-2.5-pro-preview">
                                <label class="form-check-label" for="modelGemini">
                                    {{ 'welcome.onboarding.step2.model_gemini'|trans|default('Gemini') }}
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="aiModel" id="modelGrok" value="x-ai/grok-3-beta">
                                <label class="form-check-label" for="modelGrok">
                                    {{ 'welcome.onboarding.step2.model_grok'|trans|default('Grok') }}
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group mb-3">
                        <label>{{ 'welcome.onboarding.step2.color_label'|trans|default('Spirit Color') }}</label>
                        <div class="color-picker">
                            <div class="color-option selected" style="background-color: #6c5ce7;" data-color="#6c5ce7"></div>
                            <div class="color-option" style="background-color: #00b894;" data-color="#00b894"></div>
                            <div class="color-option" style="background-color: #e84393;" data-color="#e84393"></div>
                            <div class="color-option" style="background-color: #fdcb6e;" data-color="#fdcb6e"></div>
                            <div class="color-option" style="background-color: #00cec9;" data-color="#00cec9"></div>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <button id="backToStep1" class="btn btn-outline-light">
                            {{ 'welcome.onboarding.step2.back'|trans|default('Back') }}
                        </button>
                        <button id="createSpirit" class="btn btn-cta" disabled>
                            {{ 'welcome.onboarding.step2.create'|trans|default('Create Spirit') }}
                        </button>
                    </div>
                </div>
                <div class="col-md-6 text-center">
                    <img src="{{ asset('images/spirit-active.svg') }}" alt="Spirit" class="img-fluid spirit-active" style="max-height: 200px;">
                </div>
            </div>
        </div>
        
        <!-- Step 3: Start Journey -->
        <div class="step-container" id="step3">
            <div class="text-center">
                <h2>{{ 'welcome.onboarding.step3.title'|trans|default('Your Journey Begins!') }}</h2>
                <p class="lead">{{ 'welcome.onboarding.step3.description'|trans|default('Your Spirit is ready to assist you. Start your first conversation now.') }}</p>
                
                <div class="my-5">
                    <img src="{{ asset('images/spirit-active.svg') }}" alt="Spirit" class="img-fluid spirit-active" style="max-height: 200px;">
                    <h3 id="spiritNameDisplay" class="mt-3">Spirit</h3>
                </div>
                
                <button id="startJourney" class="btn btn-cta btn-lg">
                    {{ 'welcome.onboarding.step3.start'|trans|default('Start Your Journey') }}
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
